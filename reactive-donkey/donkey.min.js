var $jscomp={scope:{},IteratorResult:function(){},Iterator:function(){},Iterable:function(){}};$jscomp.Iterable.prototype.$$iterator=function(){};$jscomp.makeIterator=function(a){if(a.$$iterator)return a.$$iterator();if(!(a instanceof Array)&&"string"!=typeof a)throw Error();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};$jscomp.copyProperties=function(a,b){for(var c in b)a[c]=b[c]};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){var g=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,g)}};function extend(a,b){for(var c in b)a[c]=b[c]}function assoc(){for(var a={},b=0;b<arguments.length;b++)extend(a,arguments[b]);return a}function onscreen(a){return!(-300>a.x||-1E3>a.y||1E3<a.y)}
function bindKey(a){var b=new Rx.Subject;Mousetrap.bind(a,function(){b.onNext(a)});return b}function coordBI(a,b){return a+(b||0)|0}function updateElement(a){$(a.id).attr("class",a.classes||"").css({left:coordBI(a.x,a.baseX)+"px",top:coordBI(a.y,a.baseY)+"px"}).text(a.text)}function velocity(a){return assoc(a,{x:a.x+a.vx,y:a.y+a.vy})}
function intersects(a,b){var c=coordBI(b.x,b.baseX),e=coordBI(a.x,a.baseX),d=coordBI(b.y,b.baseY),f=coordBI(a.y,a.baseY);return 100>Math.abs(e-c)&&100>Math.abs(f-d)}function renderScene(a){a.forEach(updateElement)}var canvas=$("#canvas");$("<div id='ground'></div>").appendTo(canvas);$("<div id='pinkie'></div>").appendTo(canvas);$("<div id='coin'></div>").appendTo(canvas);$("<div id='stat'></div>").appendTo(canvas);
var tick=bindKey("space").buffer(Rx.Observable.interval(33)),groundStream=Rx.Observable.interval(33).map(function(a){return{id:"#ground",baseX:0,y:320,x:a%280*-8}}),pinkieStream=tick.scan({id:"#pinkie",baseY:320,x:0,y:0,vx:0,vy:0},function(a,b){a=velocity(a);a.vy+=.98;0<=a.y&&0<a.vy&&(a.y=0,a.vy=0);"space"===b[0]&&0===a.y&&(a.vy=-20,(new Audio("../../media/sound/jump.mp3")).play());return a}).takeWhile(onscreen),initialStat={id:"#stat",baseX:0,baseY:0,x:0,y:0,text:"Init.."},statStream=pinkieStream.scan(initialStat,
function(a,b){a.text="Donkey y+baseY: "+coordBI(b.y,b.baseY);return a}),initialCoin={id:"#coin",vx:-6,vy:0,x:1600,y:40},coinStream=pinkieStream.scan(initialCoin,function(a,b){a=velocity(a);0===a.vy&&intersects(a,b)&&((new Audio("../../media/sound/coin.mp3")).play(),a.vx=0,a.vy=-1);0>a.vy&&(a.vy*=2);return onscreen(a)?a:initialCoin});Rx.Observable.zipArray(groundStream,pinkieStream,coinStream,statStream).subscribe(renderScene);
function doLineSegmentsIntersect(a,b,c,e){var d=subtractPoints(b,a),f=subtractPoints(e,c),g=crossProduct(subtractPoints(c,a),d),d=crossProduct(d,f);if(0==g&&0==d)return 0>c.x-a.x!=0>c.x-b.x!=0>e.x-a.x!=0>e.x-b.x||0>c.y-a.y!=0>c.y-b.y!=0>e.y-a.y!=0>e.y-b.y;if(0==d)return!1;b=g/d;a=crossProduct(subtractPoints(c,a),f)/d;return 0<=a&&1>=a&&0<=b&&1>=b}function crossProduct(a,b){return a.x*b.y-a.y*b.x}function subtractPoints(a,b){var c={};c.x=a.x-b.x;c.y=a.y-b.y;return c};
